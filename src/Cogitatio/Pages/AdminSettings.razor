@page "/AdminSettings"
<h3>Admin Settings</h3>

<p>This is the Admin Settings page. Only users with admin privileges can access this page.</p>
@if (userState.IsAdmin)
{
    <div class="@(use2FA ? "p-4 rounded border-2fa" : ""))"
         style="padding: 0; margin: 0">
        <div class="mb-3" style="padding: 0; margin: 0">
            <label for="use2FA" class="form-label">Use 2FA</label>
            <InputCheckbox 
                Value="@use2FA" 
                ValueChanged="@((bool newValue) => CheckboxChanged(newValue))"
                ValueExpression="@(() => use2FA)"
                class="form-check-input" 
                id="isActiveCheck" />
        </div>
        <div class="mb-3" id="qrcodeSection" style="display:@(use2FA ? "block" : "none")">
            <label class="form-label">Scan with your Authenticator App</label>

            <div class="row align-items-center g-4">
                <!-- LEFT: Current Code -->
                <div class="col-md-6">
                    <div class="alert alert-info mb-0 h-100 d-flex flex-column justify-content-center">
                        <div>
                            <strong>Current Code (for testing):</strong>
                            <span class="badge bg-primary fs-4 ms-2">@currentTotpCode</span>
                        </div>
                        <small class="text-muted mt-1">
                            Refreshes in <strong>@secondsRemaining</strong> seconds
                        </small>
                    </div>
                </div>

                <!-- RIGHT: QR Code -->
                <div class="col-md-6 text-center">
                    <div class="border p-3 rounded bg-white d-inline-block">
                        <img src="@qrCodeUrl"
                             alt="2FA QR Code"
                             class="img-fluid"
                             style="max-width:200px; height:auto;" />
                    </div>
                </div>
            </div>
            <div class="mb-3">
                <label for="totpCode" class="form-label">Enter verification code</label>
                <InputText @bind-Value="verificationCode" class="form-control" id="totpCode" />
            </div>
        </div>
    </div>
    <div class="mb-3">
        <label for="sitetitle" class="form-label">Site Title</label>
        <input id="sitetitle" @bind="siteTitle" class="form-control" placeholder="catch line" />
    </div>
    <div class="mb-3">
        <label for="title" class="form-label">Short Title</label>
        <input id="title" @bind="shortTitle" class="form-control" placeholder="catch line" />
    </div>
    <div class="mb-3">
        <label for="tags" class="form-label">Long Title</label>
        <input id="tags" @bind="longTitle" class="form-control" placeholder="a bigger statement" />
    </div>
    <div class="mb-3">
        <label for="copyright" class="form-label">Copyright</label>
        <input id="copyright" @bind="copyright" class="form-control" placeholder="Copyright (C) 2025 Matt Raffel. All rights reserved." />
    </div>
    <div class="mb-3">
        <label for="IntroductionEditor" class="form-label">Introduction</label>
        <TinyMCE.Blazor.Editor
            Id="IntroductionEditor"
            Conf="@editorConfig"
            ApiKey="@tinyMceKey"
            @bind-Value="introduction"/>
    </div>    
    <div class="mb-3">
        <label for="AboutEditor" class="form-label">About statements</label>
        <TinyMCE.Blazor.Editor
            Id="AboutEditor"
            Conf="@editorConfig"
            ApiKey="@tinyMceKey"
            @bind-Value="about"/>
    </div>
    <button class="btn btn-primary mt-2" @onclick=@Save>Save</button>
    <div>
        <NavLink href="/Admin">Admin</NavLink>
    </div>
}
else
{
    <div>Redirecting to Admin Login</div>
}

