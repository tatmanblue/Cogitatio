@page "/a/UserManager"
<h3>User Manager</h3>

@if (true == HasRights())
{
    @if (records == null)
    {
        <p>Loading...</p>
    }
    else if (!records.Any())
    {
        <p>No Users found.</p>
    }
    else
    {
        <table class="table table-striped table-hover">
            <thead class="table-dark">
            <tr>
                <th></th>
                <th>Display Name</th>
                <th>Email</th>
                <th>State</th>
                <th>Created</th>
            </tr>
            </thead>
            <tbody>
                @foreach (var user in records)
                {
                    <tr @onmouseover="() => ShowMessage(user.Id)">
                        <td></td>
                        <td>@user.DisplayName</td>
                        <td>@user.Email</td>
                        <td>@user.AccountState</td>
                        <td>@user.CreatedAt.ToShortDateString()</td>
                    </tr>
                    <tr class="bg-light" style="display: @(user.ShowDetails ? "table-row" : "none");">
                        <td colspan="4" class="p-2">
                            <div class="d-flex gap-2 align-items-center"></div>
                            <div class="flex-grow-1">
                                <span>for <b>@user.DisplayName</b> change status:</span>
                                <br/>
                                <label for="statusSelect">Select Status:</label>
                                <InputSelect id="statusSelect" 
                                             TValue="UserAccountStates"
                                             Value="@user.AccountState"
                                             ValueExpression="@(() => user.AccountState)" 
                                             ValueChanged="@( (UserAccountStates newState) => MarkAsChanged(user.Id, newState) )">
                                    @foreach (var states in Enum.GetValues<UserAccountStates>())
                                    {
                                        <option value="@states">@states.ToString()</option>
                                    }
                                </InputSelect>
                            </div>
                            <div class="flex-shrink-0 mt-3">
                                <button class="btn btn-primary btn-sm" @onclick="() => Save(user.Id)">Save</button>
                                <button class="btn btn-secondary btn-sm ms-2" @onclick="() => HideMessage(user.Id)">Cancel</button>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    <div>
        <NavLink href="/a/Admin">Admin</NavLink>
    </div>
}
else
{
    <div>Redirecting to Admin Login</div>
}
